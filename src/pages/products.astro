---
import StarlightPage from "@astrojs/starlight/components/StarlightPage.astro";
import { getCollection, type CollectionEntry } from "astro:content";

import ProductCatalog from "~/components/ProductCatalog";

let products: CollectionEntry<"products">[] = await getCollection(
	"products",
	(entry: CollectionEntry<"products">) => {
		return entry.data.product?.show ?? true;
	},
);

products = products.map((product) => ({
	...product,
	groups: [
		product.data.product.group,
		...(product.data.product.additional_groups || []),
	].filter((val) => Boolean(val)),
}));

const frontmatter = {
	title: "Products",
	description:
		"API reference, how-to guides, tutorials, example code, and more.",
	template: "splash",
} as const;
---

<StarlightPage frontmatter={frontmatter}>
	<ProductCatalog products={products} client:load />
</StarlightPage>

<style>
	html:not([data-has-sidebar]) {
		--sl-content-width: 75rem;
	}
</style>
